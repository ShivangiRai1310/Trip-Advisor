<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Your Trip</title>

    <!-- CSS STYLES -->
    <link rel="stylesheet" href="styles-map.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- BOOTSTRAP SCRIPTS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

    <!-- FONT AWESOME ICONS -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css"
        integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">

</head>

<body>

    <!-- HEADER SECTION -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #000839;">
            <!-- Brand -->
            <a class="navbar-brand" href="./"><img class="logo-part1" src="../images/logo-part1.png"
                    alt="Trip advisor"></a>
            <a class="navbar-brand" href="./"><img class="logo-part2" src="../images/logo-part2.png"
                    alt="Trip advisor"></a>
        </nav>
    </header>

    <section id="overview">
        <h2><a>Plan your trip here</a></h2>
        <div class="container-fluid row text-center px-5 mt-5">
            <div class="col-xl-6 col-sm-12 px-5">
                <h3 class="text-center mb-4">Overview</h3>
                <p>Want to customize your trip according to your own time and way?
                    Try and do it with this feature of ours.Just tell us where you want to
                    start your journey from and where you plan to go. Rest will be taken care
                    by us. We provide you with a simple to understand and follow map so that you
                    know where you are headed in the new city.</p>
            </div>
            <!-- <div class="col-xl-6 col-sm-12 my-auto text-center px-5 py-2">
                <div class="container-fluid" style="width: 500px; height: 300px; background-color: aliceblue;">
                    Video description
                </div>
            </div> -->
            <div class="col-xl-6 col-sm-12 my-auto text-center px-5 py-2">
                <div class="container-fluid">
                  <video width="500" height="300" controls>
                    <source src="../video-clips/Mountain.mp4" type="video/mp4">
                    <source src="../video-clips/Mountain.ogg" type="video/ogg">
                    Your browser does not support HTML video.
                  </video>
                </div>
              </div>
        </div>
    </section>

    <section id="details">
        <div class="container-fluid">

            <form action="/get-location" method="post">
                <div class="row ml-auto px-5 py-3">
                    <div class="col-8 mr-auto form-group py-2">
                        <label>Select City</label>
                        <select class="form-control select-city" id="city" name="city_id" required>
                            <option value="" disabled selected>Select city to get locations</option>
                            <%  for(var i=0; i<cities.length;i++){ %>
                            <option value="<%= cities[i].city_id %>"><%= cities[i].name %></option>
                            <% } %>
                        </select>
                    </div>
                    <div class="col-4 my-auto">
                        <button type="submit" id="submit" name="submit"
                            class="btn btn-info btn-lg get-location mx-3 my-2"><i
                                class="fas fa-search-location fa-lg mr-3 my-2"></i>Get Locations</button>
                    </div>
                </div>
            </form>

            <div class="row ml-auto px-5 py-3 my-5">
                <div class="col-3 form-group py-2">
                    <label>Start</label>
                    <select class="form-control " id="start" name="start_place" required>
                        <option value="" disabled selected>Select start location</option>
                        <%  for(var i=0; i<places.length;i++){ %>
                        <option value="<%= places[i].place_id %>" data-lat="<%= places[i].latitude %>"
                            data-long="<%= places[i].longitude %>"><%= places[i].place_name %></option>
                        <% } %>
                    </select>
                </div>
                <div class="col-3 form-group py-2">
                    <label>Waypoints (Ctrl+Click for multiple selection)</label>
                    <select class="form-control" id="waypoints" name="waypoints" multiple required>
                        <option value="" disabled selected>Select places to visit</option>
                        <%  for(var i=0; i<places.length;i++){ %>
                        <option value="<%= places[i].place_id %>" data-lat="<%= places[i].latitude %>"
                            data-long="<%= places[i].longitude %>"><%= places[i].place_name %></option>
                        <% } %>
                    </select>
                </div>
                <div class="col-3 form-group py-2">
                    <label>End</label>
                    <select class="form-control" id="end" name="end_place" required>
                        <option value="" disabled selected>Select end location</option>
                        <%  for(var i=0; i<places.length;i++){ %>
                        <option value="<%= places[i].place_id %>" data-lat="<%= places[i].latitude %>"
                            data-long="<%= places[i].longitude %>"><%= places[i].place_name %></option>
                        <% } %>
                    </select>
                </div>
                <div class="col-3 py-2">
                <button id="loadmap" class="btn btn-success btn-lg">Load Map</button></div>
            </div>

            <a href="/trip-plan"><button class="btn btn-danger btn-lg mr-auto"><i class="fas fa-redo mr-3"></i>Refresh
                    Page</button></a>
        </div>
    </section>

    <section id="map-display">
        <div id="map"></div>
    </section>

    <section id="route">
        <div id="directions-panel"></div>
    </section>



    <footer>
        <div class="container-fluid row">
            <div class="col-lg-4 col-md-6 my-auto d-flex justify-content-center"><a href="index.html"><img
                        src="images/logo.png" alt="Trip advisor"></a></div>
            <div class="col-lg-4 col-md-2 my-auto d-flex justify-content-center text-center"> <i
                    class="social-icon fab fa-facebook-f fa-lg"></i>
                <i class="social-icon fab fa-twitter fa-lg"></i>
                <i class="social-icon fab fa-instagram fa-lg"></i>
                <i class="social-icon fas fa-envelope fa-lg"></i></div>
            <div class="col-lg-4 col-md-4  my-auto justify-content-center text-center">
                <p>TripAdvisor@gmail.com <br>Contact us : 1234567890 <br>Â© Copyright 2020 TripAdvisor</p>
            </div>
        </div>
    </footer>

    <script type="text/javascript">

        var liveLat, liveLong;
        function initMap() {     //func in callback executed for map

            var directionsService = new google.maps.DirectionsService;
            var directionsDisplay = new google.maps.DirectionsRenderer;

            var options = {
                zoom: 3,
                center: { lat: 17.3850, lng: 78.4867 },
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            var map = new google.maps.Map(document.getElementById("map"), options);    //displays map with position centered,takes 2 para id where to display n options

            infoWindow = new google.maps.InfoWindow;
            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    liveLat = position.coords.latitude;
                    liveLong = position.coords.longitude;
                    //infoWindow.setPosition(pos);
                    //infoWindow.setContent('Location found.');
                    infoWindow.open(map);   //displays map
                    console.log(pos);     //current position
                    map.setCenter(pos);
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }

            directionsDisplay.setMap(map);

            document.getElementById('loadmap').addEventListener(
                'click',
                function () {
                    calculateAndDisplayRoute(directionsService,
                        directionsDisplay);
                });
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ? 'Error: The Geolocation service failed.'
                : 'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }

        function calculateAndDisplayRoute(directionsService, directionsDisplay) {
            var waypts = [];
            var checkboxArray = document.getElementById('waypoints');
            // console.log(checkboxArray);
            for (var i = 1; i < checkboxArray.length; i++) {
                if (checkboxArray.options[i].selected) {
                    console.log($(checkboxArray[i]).attr("data-lat") + "---" + $(checkboxArray[i]).attr("data-long"));
                    waypts.push({
                        location: new google.maps.LatLng($(checkboxArray[i]).attr("data-lat"), $(checkboxArray[i]).attr("data-long")),
                        stopover: true
                    });
                }
            }
            // console.log($('option:selected', $("#start")).attr('data-lat'));
            // console.log($('option:selected', $("#end")).attr('data-lat'));
            directionsService.route({
                // origin: document.getElementById('start').value,
                // destination: document.getElementById('end').value,               
                origin: new google.maps.LatLng($('option:selected', $("#start")).attr('data-lat'), $('option:selected', $("#start")).attr('data-long')),
                destination: new google.maps.LatLng($('option:selected', $("#end")).attr('data-lat'), $('option:selected', $("#end")).attr('data-long')),
                waypoints: waypts,
                optimizeWaypoints: true,
                travelMode: 'DRIVING'
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    var route = response.routes[0];
                    var summaryPanel = document.getElementById('directions-panel');
                    summaryPanel.innerHTML = '';
                    // For each route, display summary information.
                    for (var i = 0; i < route.legs.length; i++) {
                        var routeSegment = i + 1;
                        summaryPanel.innerHTML += '<b><h5>Route Segment: '
                            + routeSegment + '</b></h5><br>';
                        summaryPanel.innerHTML += '<b>Start Address :  </b>' + route.legs[i].start_address
                            + ' <br> ';
                        summaryPanel.innerHTML += '<b>End Address :  </b>' + route.legs[i].end_address
                            + '<br>';
                        summaryPanel.innerHTML += '<b>Distance :  </b>' + route.legs[i].distance.text
                            + '<br><br><br>';
                    }
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        }
    </script>

    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>

    <!-- Bootstrap tooltips -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <!-- Bootstrap core JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
        integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>
    <!-- GOOGLE MAPS API -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBAoKQLHah3tfC-Hq0ikM4np-LDwptN2Y&callback=initMap"></script>
    <!-- <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDa59eQ6ObjDdSCeBBMH8E7hg-GU9n8qsU&callback=initMap"></script>  -->
    <!-- BASE JS
    <script src="script-map.js"></script> -->

</body>

</html>